<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Shooter Custom</title>
    <style>
        /* --- DESIGN & LAYOUT --- */
        body {
            margin: 0; padding: 0;
            background-color: #0b0c10;
            font-family: Arial, sans-serif;
            overflow: hidden; 
            touch-action: none; /* Wichtig für Handy-Steuerung */
            user-select: none;
        }

        #spielKasten {
            position: relative;
            width: 100vw; height: 100vh;
            max-width: 800px; max-height: 600px;
            background: black;
            margin: auto;
            box-shadow: 0 0 20px rgba(226, 5, 5, 0.2);
        }

        canvas { width: 100%; height: 100%; display: block; }

        /* Texte und Menüs */
        .overlay {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            color: white; z-index: 100;
        }

        .anzeige {
            position: absolute; top: 10px; left: 10px;
            color: white; font-size: 18px; font-weight: bold;
            pointer-events: none; z-index: 50;
        }

        button {
            background-color: #eb0c0c; border: none;
            padding: 15px 40px; margin: 10px;
            font-size: 20px; font-weight: bold;
            border-radius: 8px; cursor: pointer;
        }

        /* Handy Steuerung */
        .handy-steuerung {
            position: absolute; bottom: 20px; width: 100%;
            display: flex; justify-content: space-between;
            padding: 0 20px; box-sizing: border-box;
            pointer-events: none; z-index: 80;
        }

        .knopf {
            width: 80px; height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #eb0b0b; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 30px; color: white;
            pointer-events: auto; 
            touch-action: manipulation;
        }

        .feuer-knopf { border-color: #ff2e63; color: #ff2e63; }
    </style>
</head>
<body>

<div id="spielKasten">
    <div class="anzeige">
        <div>PUNKTE: <span id="punkteText">0</span></div>
        <div style="font-size: 14px; color: #aaa;">REKORD: <span id="rekordText">0</span></div>
        <div id="powerupText" style="color: #ff2e63; display:none;">Ouzo Boost: <span id="zeitText">0</span>s</div>
    </div>

    <canvas id="leinwand" width="800" height="600"></canvas>

    <div id="startMenue" class="overlay">
        <h1 style="color: #df1414;">shoot Rotzer</h1>
        <p>Wähle deine Mission:</p>
        <button onpointerdown="starteSpiel('leicht')">LEICHT</button>
        <button onpointerdown="starteSpiel('mittel')">MITTEL</button>
        <button onpointerdown="starteSpiel('schwer')">SCHWER</button>
    </div>

    <div id="endeMenue" class="overlay" style="display: none;">
        <h1 style="color: #b10933;">Rotzer erwischt dich</h1>
        <p>Erreichte Punkte: <span id="endPunkte">0</span></p>
        <button onpointerdown="location.reload()">NEUSTART</button>
    </div>

    <div class="handy-steuerung">
        <div style="display: flex; gap: 15px;">
            <div class="knopf" id="btnLinks">◀</div>
            <div class="knopf" id="btnRechts">▶</div>
        </div>
        <div class="knopf feuer-knopf" id="btnFeuer">Feuer</div>
    </div>
</div>

<script>
    // ==========================================
    // 1. DAS COCKPIT - HIER ALLES EINSTELLEN!
    // ==========================================
    const EINSTELLUNGEN = {
        
        spieler: {
            breite: 80,   // Breite des Spielers in Pixeln
            hoehe: 80,    // Höhe des Spielers in Pixeln
            tempo: 8      // Bewegungsgeschwindigkeit
        },

        gegner: {
            breite: 80,   // Wie breit ist ein Gegner?
            hoehe: 80     // Wie hoch ist ein Gegner?
        },

        schuss: {
            breite: 20,   // Mach den Schuss breiter (z.B. 20)
            hoehe: 30,    // Mach den Schuss länger (z.B. 40)
            tempo: 12     // Wie schnell fliegt der Laser?
        },

        powerup: {
            breite: 20,   // Größe des PowerUp Items
            hoehe: 65,
            dauer: 7      // Wie lange hält der Triple-Shot (Sekunden)
        },

        // Schwierigkeitsgrade (Spawnrate: Je kleiner die Zahl, desto mehr Gegner)
        level: {
            leicht:  { spawnRate: 70, gegnerTempo: 3, punkte: 10 },
            mittel:  { spawnRate: 45, gegnerTempo: 5, punkte: 20 },
            schwer:  { spawnRate: 25, gegnerTempo: 8, punkte: 50 }
        }
    };

    // ==========================================
    // 2. TECHNIK & START
    // ==========================================
    const canvas = document.getElementById('leinwand');
    const ctx = canvas.getContext('2d');

    // Bilder laden
    const bildSpieler = new Image(); bildSpieler.src = 'spieler.png';
    const bildGegner = new Image();  bildGegner.src = 'gegner.png';
    const bildSchuss = new Image();  bildSchuss.src = 'schuss.png';
    const bildPower = new Image();   bildPower.src = 'powerup.png';

    let spielLaeuft = false;
    let punkte = 0;
    let frames = 0;
    let aktuellesLevel = EINSTELLUNGEN.level.mittel;
    
    let tripleShotAktiv = false;
    let powerupZeit = 0;

    // Spieler erstellen mit den Maßen aus dem Cockpit
    const spieler = { 
        x: 370, 
        y: 500, 
        breite: EINSTELLUNGEN.spieler.breite, 
        hoehe: EINSTELLUNGEN.spieler.hoehe, 
        dx: 0 
    };

    let schuesse = [];
    let gegnerListe = [];
    let powerups = [];

    document.getElementById('rekordText').innerText = localStorage.getItem('meinHighscore') || 0;

    // ==========================================
    // 3. STEUERUNG
    // ==========================================
    window.addEventListener('keydown', t => {
        if (t.key === 'ArrowLeft') spieler.dx = -EINSTELLUNGEN.spieler.tempo;
        if (t.key === 'ArrowRight') spieler.dx = EINSTELLUNGEN.spieler.tempo;
        if (t.key === ' ' || t.key === 'ArrowUp') schiessen();
    });
    window.addEventListener('keyup', () => spieler.dx = 0);

    // Handy Touch
    function verbindeKnopf(id, start, ende) {
        const btn = document.getElementById(id);
        btn.addEventListener('pointerdown', e => { e.preventDefault(); start(); });
        btn.addEventListener('pointerup', e => { e.preventDefault(); ende(); });
        btn.addEventListener('pointerleave', e => { e.preventDefault(); ende(); });
    }
    verbindeKnopf('btnLinks', () => spieler.dx = -EINSTELLUNGEN.spieler.tempo, () => spieler.dx = 0);
    verbindeKnopf('btnRechts', () => spieler.dx = EINSTELLUNGEN.spieler.tempo, () => spieler.dx = 0);
    document.getElementById('btnFeuer').addEventListener('pointerdown', e => { e.preventDefault(); schiessen(); });

    // ==========================================
    // 4. SPIEL LOGIK
    // ==========================================
    function schiessen() {
        if (!spielLaeuft) return;
        let winkelListe = tripleShotAktiv ? [-3, 0, 3] : [0];

        // Berechnet die Mitte des Spielers, damit der Schuss mittig rauskommt
        const startX = spieler.x + (EINSTELLUNGEN.spieler.breite / 2) - (EINSTELLUNGEN.schuss.breite / 2);

        winkelListe.forEach(winkel => {
            schuesse.push({
                x: startX,
                y: spieler.y,
                breite: EINSTELLUNGEN.schuss.breite,
                hoehe: EINSTELLUNGEN.schuss.hoehe,
                winkel: winkel
            });
        });
    }

    function update() {
        if (!spielLaeuft) return;

        // Spieler bewegen
        spieler.x += spieler.dx;
        if (spieler.x < 0) spieler.x = 0;
        if (spieler.x > canvas.width - spieler.breite) spieler.x = canvas.width - spieler.breite;

        // PowerUp Timer
        if (tripleShotAktiv) {
            powerupZeit -= 1/60;
            document.getElementById('zeitText').innerText = Math.ceil(powerupZeit);
            if (powerupZeit <= 0) {
                tripleShotAktiv = false;
                document.getElementById('powerupText').style.display = 'none';
            }
        }

        // Schüsse
        schuesse.forEach((s, i) => {
            s.y -= EINSTELLUNGEN.schuss.tempo;
            s.x += s.winkel;
            if (s.y < -50) schuesse.splice(i, 1);
        });

        // Gegner
        if (frames % aktuellesLevel.spawnRate === 0) {
            gegnerListe.push({
                x: Math.random() * (canvas.width - EINSTELLUNGEN.gegner.breite),
                y: -50,
                breite: EINSTELLUNGEN.gegner.breite,
                hoehe: EINSTELLUNGEN.gegner.hoehe
            });
        }

        gegnerListe.forEach((g, i) => {
            g.y += aktuellesLevel.gegnerTempo;
            if (kollision(spieler, g)) gameOver();
            
            schuesse.forEach((s, si) => {
                if (kollision(s, g)) {
                    gegnerListe.splice(i, 1);
                    schuesse.splice(si, 1);
                    punkte += aktuellesLevel.punkte;
                    document.getElementById('punkteText').innerText = punkte;
                }
            });
            if (g.y > canvas.height) gegnerListe.splice(i, 1);
        });

        // Powerups
        if (frames % 900 === 0) {
            powerups.push({ 
                x: Math.random() * (canvas.width - EINSTELLUNGEN.powerup.breite), 
                y: -50, 
                breite: EINSTELLUNGEN.powerup.breite, 
                hoehe: EINSTELLUNGEN.powerup.hoehe 
            });
        }
        powerups.forEach((p, i) => {
            p.y += 3;
            if (kollision(spieler, p)) {
                tripleShotAktiv = true;
                powerupZeit = EINSTELLUNGEN.powerup.dauer;
                document.getElementById('powerupText').style.display = 'block';
                powerups.splice(i, 1);
            }
        });
        frames++;
    }

    function kollision(a, b) {
        return a.x < b.x + b.breite && a.x + a.breite > b.x && a.y < b.y + b.hoehe && a.y + a.hoehe > b.y;
    }

    function zeichnen() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const maleObjekt = (bild, obj, farbe) => {
            if (bild.complete && bild.naturalHeight !== 0) ctx.drawImage(bild, obj.x, obj.y, obj.breite, obj.hoehe);
            else { ctx.fillStyle = farbe; ctx.fillRect(obj.x, obj.y, obj.breite, obj.hoehe); }
        };

        maleObjekt(bildSpieler, spieler, '#4ecca3');
        schuesse.forEach(s => maleObjekt(bildSchuss, s, '#ff2e63'));
        gegnerListe.forEach(g => maleObjekt(bildGegner, g, '#fce38a'));
        powerups.forEach(p => maleObjekt(bildPower, p, '#00ff00'));

        if (spielLaeuft) requestAnimationFrame(() => { update(); zeichnen(); });
    }

    function starteSpiel(lvl) {
        aktuellesLevel = EINSTELLUNGEN.level[lvl];
        document.getElementById('startMenue').style.display = 'none';
        spielLaeuft = true;
        zeichnen();
    }

    function gameOver() {
        spielLaeuft = false;
        document.getElementById('endeMenue').style.display = 'flex';
        document.getElementById('endPunkte').innerText = punkte;
        const h = localStorage.getItem('meinHighscore') || 0;
        if (punkte > h) localStorage.setItem('meinHighscore', punkte);
    }
</script>
</body>
</html>